{"version":3,"file":"metagrid-widget.es.js","sources":["../src/metagrid-api.ts","../src/metagrid-widget.ts"],"sourcesContent":["/**\n * Possible metagrid entities\n */\nexport enum MetagridEntities {\n  person = 'person',\n}\n\n/**\n * Supported metagrid languages\n */\nexport enum MetagridLanguages {\n  de = 'de',\n  fr = 'fr',\n  en = 'en',\n  it = 'it',\n  nl = 'nl',\n}\n\n/**\n * Metagrid status will return the state of the response\n * possible status-codes: all http status codes and 0. 0 stands for a general network issue\n * */\nexport interface MetagridStatus {\n  found: boolean\n  statusCode: number\n  error?: string\n}\n\n/**\n * The final struct of a fetch call with the status and the data\n */\nexport interface MetagridData {\n  status: MetagridStatus\n  data: MetagridLinks | []\n}\n\n/**\n * All possible values for a single link of metagrid\n */\nexport interface MetagridLink {\n  provider: string\n  url: string\n  shortDescription?: string\n  longDescription?: string\n}\n\n/**\n * An array of Metagrid links\n */\ninterface MetagridLinks extends Array<MetagridLink> {}\n\n/**\n * A single item detail from the metagrid api\n */\ninterface metagridResponseItmDetail {\n  url: string\n  short_description: string\n  long_description: string\n}\n\n/**\n * A single item from the metagrid api\n */\ntype metagridResponseItem = Record<string, metagridResponseItmDetail | string>\n\n/**\n * The metagrid api response\n */\ninterface metagridResponse extends Array<metagridResponseItem> {}\n\n/**\n * MetagridApi class to fetch data from the metagrid server\n */\nexport class MetagridApi {\n  /**\n     * Slug of a project\n     * You can find all the slugs over https://api.metagrid.ch/providers.json?size=40\n     * f.e. https://dodis.ch/P5 -> projectSlug: dodis\n     * @private\n     */\n  private readonly projectSlug: string\n\n  /**\n     * The entity to query\n     * @private\n     */\n  private readonly entity: MetagridEntities = MetagridEntities.person\n\n  /**\n     * Metagrid api url\n     * @private\n     */\n  private readonly apiUrl: string = 'https://api.metagrid.ch'\n\n  constructor (projectSlug: string, entity: MetagridEntities, apiUrl?: string) {\n    this.projectSlug = projectSlug\n    this.entity = entity\n    if (typeof apiUrl !== 'undefined') {\n      this.apiUrl = apiUrl\n    }\n  }\n\n  /**\n     * Fetch a metagrid identifier\n     * @param identifier\n     * @param langauge\n     * @param includeDescription\n     * @throws error if the fetch process fails\n     */\n  public async fetch (identifier: string, langauge: MetagridLanguages = MetagridLanguages.de, includeDescription: boolean = false): Promise<MetagridData> {\n    const queryParams: string[] = []\n    queryParams.push(`include=${String(includeDescription)}`)\n    queryParams.push(`language=${langauge}`)\n    try {\n      const resp = await fetch(`${this.apiUrl}/widget/${this.projectSlug}/${this.entity}/${identifier}.json?${queryParams.join('&')}`)\n      // 4xx or 5xx error in the api\n      if (!resp.ok) {\n        return this.buildResponse(resp)\n      }\n      // return successfully\n      return this.buildResponse(resp, this.transform(await resp.json()))\n    } catch (error) {\n      // return a general network error\n      return this.buildResponse({\n        statusCode: 0,\n        found: false,\n        error: 'unknown network error'\n      })\n    }\n  }\n\n  /**\n     * Build the MetagridData object for a given response or status\n     * @param status\n     * @private\n     */\n  private buildResponse (status: MetagridStatus): MetagridData\n  private buildResponse (resp: Response): MetagridData\n  private buildResponse (resp: Response, data: MetagridLinks | []): MetagridData\n  private buildResponse (resp: any, data: MetagridLinks | [] = []): MetagridData {\n    if ('ok' in resp) {\n      return {\n        status: {\n          statusCode: resp.status,\n          found: resp.status === 200,\n          error: resp.statusText\n        },\n        data\n      }\n    } else {\n      return {\n        status: resp as MetagridStatus,\n        data: []\n      }\n    }\n  }\n\n  /**\n     * Map the response from metagrid to an array of objects\n     * @param data\n     * @private\n     */\n  private transform (data: metagridResponse): MetagridLinks {\n    return Object.keys(data[0]).map((key) => {\n      const item: metagridResponseItmDetail | string = data[0][key]\n      if (typeof item === 'string') {\n        return {\n          provider: key,\n          url: item\n        }\n      }\n      const result: MetagridLink = {\n        provider: key,\n        url: item.url,\n        shortDescription: item.short_description,\n        longDescription: item.long_description\n      }\n      return result;\n    })\n  }\n\n  /**\n     * Fabric to create a new MetagridApi instance\n     * @param projectSlug\n     * @param entity\n     */\n  public static create (projectSlug: string, entity: string = 'person'): MetagridApi {\n    return new MetagridApi(projectSlug, entity as MetagridEntities)\n  }\n}\n","import { MetagridApi, MetagridData, MetagridLanguages } from './metagrid-api.js'\n\n/**\n   * Widget renders the metagrid links into a given html element\n   * @param mountTo\n   * @param projectSlug\n   * @param identifier\n   * @param language\n   * @param includeDescription\n   */\nexport async function widget (mountTo: HTMLElement, projectSlug: string, identifier: string, language: string = 'de', includeDescription = false): Promise<void> {\n  const api: MetagridApi = MetagridApi.create(projectSlug)\n  const data: MetagridData = await api.fetch(identifier, language as MetagridLanguages, includeDescription)\n  if (data.status.found) {\n    // build up link list\n    const ul = document.createElement('ul')\n    ul.classList.add('metagrid-list')\n    data.data.forEach((d) => {\n      const link = d\n      const li = document.createElement('li')\n      li.classList.add('metagrid-item')\n      const a = document.createElement('a')\n      a.classList.add('metagrid-link')\n      a.href = link.url\n      a.innerText = link.provider\n      a.target = '_blank'\n      // check if we can set a title\n      if (typeof link.longDescription !== 'undefined') {\n        a.title = link.longDescription\n      }\n      li.append(a)\n      ul.append(li)\n    })\n    mountTo.append(ul)\n    mountTo.append(credit(language as MetagridLanguages))\n  } else {\n    console.info(`Metagrid didn't find a concordance. Statuscode: ${data.status.statusCode}, error: ${data.status.error as string}`)\n  }\n}\n\n/**\n   * Create credit div for metagrid\n   * @param language\n   */\nexport function credit (language?: MetagridLanguages): HTMLElement {\n  const div = document.createElement('div')\n  div.classList.add('metagrid-credit')\n  let sahsText: string = 'the networking initiative of the SAHS'\n  switch (language) {\n    case MetagridLanguages.de:\n      sahsText = 'die Vernetzungsinitiative der SAGW'\n      break\n    case MetagridLanguages.fr:\n      sahsText = 'l’initiative de mise en réseau de l’ASSH'\n      break\n    case MetagridLanguages.it:\n      sahsText = 'l’iniziativa di messa in rete dell’ASSU'\n      break\n  }\n  div.innerHTML = `Links powered by <a href=\"https://www.metagrid.ch\" target=\"_blank\">Metagrid</a> – ${sahsText}`\n  return div\n}\n"],"names":["MetagridLanguages","MetagridApi","projectSlug","entity","apiUrl","__publicField","identifier","langauge","includeDescription","__async","queryParams","resp","error","data","key","item","widget","mountTo","language","ul","d","link","li","a","credit","div","sahsText"],"mappings":"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"}